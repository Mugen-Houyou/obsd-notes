---
id: Untitled
created_date: 2024-02-22
updated_date: 2024-02-22
type: post
link: 
tags:
  - Backend
  - Backend/Spring
  - CI_CD
  - CI_CD/Jenkins
  - Cloud
  - Cloud/AWS
---
# 2024.2.22. Cloud Project: AWS EC2 ì¸ìŠ¤í„´ìŠ¤ 2ê°œë¡œ Jenkins + Spring
- **ğŸ·ï¸Tags** :   #02-2024 #CI_CD #CI_CD/Jenkins #Backend #Backend/Spring #Cloud #Cloud/AWS 

### ì´ë²ˆ ì£¼ ìˆ˜ì—… ë‚´ìš© ì •ë¦¬
- AWS EC2, IAM, key pair ê°œë…
- AWS EC2 ì¸ìŠ¤í„´ìŠ¤ì— Docker, Jenkins ì„¤ì¹˜ ë° `github-webhook`ë¥¼ í†µí•œ CI êµ¬ì„±
### ì˜¤ëŠ˜ ì‹¤ìŠµ ëª©í‘œ
- EC2 ì¸ìŠ¤í„´ìŠ¤ë¥¼ t2.2xl ë° t2.micë¡œ êµ¬ì„±í•˜ì—¬, 2xlì—ëŠ” Docker+Jenkins, micì—ëŠ” ë¯¸ë¦¬ ë¹Œë“œëœ `.jar`íŒŒì¼ì„ ì´ìš©í•˜ì—¬ Spring Web Server êµ¬ë™
### Jenkins Plugin: Publish over SSH
- ê°œìš”
> Jenkinsì—ì„œ ë¹Œë“œ í›„ íŠ¹ì • ì„œë²„ë¡œ ë°°í¬ ì‹œ ì‚¬ìš©í•˜ëŠ” í”ŒëŸ¬ê·¸ì¸
> 2022. 1. 12.ë¶€ë¡œ Jenkinsì˜ ë³´ì•ˆ ì •ì±…ìœ¼ë¡œ ì¸í•´ ë°°í¬ ì¤‘ë‹¨ë¨
> ì¦‰, ëª…ì‹œì ì¸ ì„¤ì¹˜ í•„ìš”.
> TODO: ë³´ì•ˆ ë¬¸ì œë¥¼ í•´ê²°í•œ WORKAROUND ì°¾ì•„ë³¼ ê²ƒ!
### AWS EC2 Jenkins Server Setup

#### ğŸ–¥ï¸ Docker + Jenkinsë¥¼ ìœ„í•œ EC2 Instance ìƒì„±:
- **Instance íƒ€ì…**: t2.2xlarge
- **OS**: Ubuntu 22.04 LTS
- **Tasks**:
  1. ì¸ìŠ¤í„´ìŠ¤ ìƒì„± í›„ ì´ˆê¸° ì…‹ì—…
	  - APT ì—…ë°ì´íŠ¸/ì—…ê·¸ë ˆì´ë“œ, ìŠ¤ì™‘ ë©”ëª¨ë¦¬ êµ¬ì„±, ì¬ë¶€íŒ…
  2. Docker ì„¤ì¹˜
  3. Dockerë¥¼ í†µí•´ Jenkins ì´ë¯¸ì§€ ëŒì–´ì˜¤ê¸°
  4. Jenkins ì»¨í…Œì´ë„ˆ ì‹¤í–‰
  5. Jenkins ì»¨í…Œì´ë„ˆ ì´ˆê¸° ì…‹ì—…
  6. Jenkinsì˜ Publish over SSH í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜
### Spring Web Server Setup

#### ğŸŒ ìŠ¤í”„ë§ ì›¹ì„œë²„ë¥¼ ìœ„í•œ EC2 Instance ìƒì„±:
- **Instance íƒ€ì…**: t2.micro
- **OS**: Ubuntu 22.04 LTS
- **Tasks**:
  1. ì¸ìŠ¤í„´ìŠ¤ ìƒì„± í›„ ì´ˆê¸° ì…‹ì—…
	  - APT ì—…ë°ì´íŠ¸/ì—…ê·¸ë ˆì´ë“œ, ìŠ¤ì™‘ ë©”ëª¨ë¦¬ êµ¬ì„±, ì¬ë¶€íŒ…
  2. ì¸ìŠ¤í„´ìŠ¤ì— `openjdk-17-jdk` ì„¤ì¹˜
  4. `.jar` íŒŒì¼ì„ í†µí•´ ìŠ¤í”„ë§ ì„œë²„ ì‹¤í–‰
#### ğŸš€ Jenkins Deployment Pipeline:
- ì•„ë˜ì™€ ê°™ì€ pipelineì„ êµ¬ì„±:
```
pipeline {
    agent any
    stages {      
        stage('git clone') {
            steps {
                echo 'clone start'
                git branch: 'main', 
                credentialsId: '<EXAMPLE_CREDENTIAL_ID>', 
                url: 'https://github.com/Mugen-Houyou/fisa_testrep_240920.git'
                echo 'clone end'
            }
        }
    
        stage('list view') {
            steps {
                echo 'ë¦¬ìŠ¤íŠ¸ ë³´ê¸°'
                sh ''' ls '''
            }
        }
        
        stage('build') {
            steps {
                echo 'Building Gradle project'
                sh ''' ./gradlew build '''
            }
        }
        stage('deploy') {
            steps {
                sshPublisher(
                    publishers: [
                        sshPublisherDesc(
                            configName: 'ec2-t2mic-ubuntu', 
                            transfers: [
                                sshTransfer(
                                    cleanRemote: false, 
                                    excludes: '',
                                    execCommand: 'nohup java -jar step06_citest-0.0.1-SNAPSHOT.jar > output.log 2>&1 &', 
                                    execTimeout: 4400, 
                                    flatten: false, 
                                    makeEmptyDirs: false, 
                                    noDefaultExcludes: false, 
                                    patternSeparator: '[, ]+', 
                                    remoteDirectory: '', 
                                    remoteDirectorySDF: false, 
                                    removePrefix: '', 
                                    sourceFiles: 'build/libs/*SNAPSHOT.jar'
                                )], 
                            usePromotionTimestamp: false, 
                            useWorkspaceInPromotion: false, 
                            verbose: true
                    )])
            }
            post {
                success {
                    echo "DONE"
                }
            }
        }
        
    }
}
```
### Jenkinsì—ì„œ ìµœì¢… ê²°ê³¼ í™•ì¸

![[Pasted image 20240222175159 1.png|600]]
![[Pasted image 20240222180841.png]]
## ğŸ› ï¸ êµ¬í˜„ ì‹œ ë…¸íŠ¸
- `.jar` íŒŒì¼ì„ ë°±ê·¸ë¼ìš´ë“œë¡œ êµ¬ë™í•˜ê¸° ìœ„í•œ `nohup` 
- Ubuntuì˜ í˜„ì¬ CPU, RAM, ìŠ¤í† ë¦¬ì§€ ì •ë³´ í•œ ëˆˆì— ë³´ê¸°:
	```bash
	cat /proc/cpuinfo;free -h;df -h
	```
## ğŸ“š ì°¸ê³ ìë£Œ
- ì‰½ê²Œ ì„¤ëª…í•œ nohup ê³¼ &(ë°±ê·¸ë¼ìš´ë“œ) ëª…ë ¹ì–´ ì‚¬ìš©ë²• [joonyon.tistory.com](https://joonyon.tistory.com/entry/%EC%89%BD%EA%B2%8C-%EC%84%A4%EB%AA%85%ED%95%9C-nohup-%EA%B3%BC-%EB%B0%B1%EA%B7%B8%EB%9D%BC%EC%9A%B4%EB%93%9C-%EB%AA%85%EB%A0%B9%EC%96%B4-%EC%82%AC%EC%9A%A9%EB%B2%95)
